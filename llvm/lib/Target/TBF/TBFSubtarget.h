//===-- TBFSubtarget.h - Define Subtarget for the TBF -----------*- C++ -*-===//
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//
//
// This file declares the TBF specific subclass of TargetSubtargetInfo.
//
//===----------------------------------------------------------------------===//

#ifndef LLVM_LIB_TARGET_TBF_TBFSUBTARGET_H
#define LLVM_LIB_TARGET_TBF_TBFSUBTARGET_H

#include "TBFFrameLowering.h"
#include "TBFISelLowering.h"
#include "TBFInstrInfo.h"
#include "TBFRegisterInfo.h"
#include "TBFSelectionDAGInfo.h"
#include "llvm/CodeGen/GlobalISel/CallLowering.h"
#include "llvm/CodeGen/GlobalISel/InstructionSelector.h"
#include "llvm/CodeGen/GlobalISel/LegalizerInfo.h"
#include "llvm/CodeGen/RegisterBankInfo.h"
#include "llvm/CodeGen/SelectionDAGTargetInfo.h"
#include "llvm/CodeGen/TargetSubtargetInfo.h"
#include "llvm/IR/DataLayout.h"
#include "llvm/Target/TargetMachine.h"

#define GET_SUBTARGETINFO_HEADER
#include "TBFGenSubtargetInfo.inc"

namespace llvm {
class StringRef;

class TBFSubtarget : public TBFGenSubtargetInfo {
  virtual void anchor();
  TBFInstrInfo InstrInfo;
  TBFFrameLowering FrameLowering;
  TBFTargetLowering TLInfo;
  TBFSelectionDAGInfo TSInfo;

private:
  void initializeEnvironment(const Triple &TT);
  void initSubtargetFeatures(StringRef CPU, StringRef FS);

protected:
  // whether the cpu supports jmp ext
  bool HasJmpExt;

  // whether the cpu supports alu32 instructions.
  bool HasAlu32;

  // whether we should use fixed or dynamic frames
  bool HasDynamicFrames;

  // Relocate FK_Data_8 fixups as R_TBF_64_ABS64
  bool UseRelocAbs64;

  // Not used for anything, just set by the static-syscalls marker feature.
  bool HasStaticSyscalls;

  // whether we should enable MCAsmInfo DwarfUsesRelocationsAcrossSections
  bool UseDwarfRIS;

  // Whether to disable the negate (neg) instruction
  bool DisableNeg;

  // Whether to consider 'sub reg, imm' as 'reg = imm - reg', instead of 'reg =
  // reg - imm'.
  bool ReverseSubImm;

  // Whether we should use the LDDW instruction
  bool NoLddw;

  // Whether to encode destination register in Callx's src field
  bool CallxRegSrc;

  // Whether we have the PQR instruction class
  bool HasPqrClass;

  // Whether we have store imm instructions
  bool HasStoreImm;

  // Whether we have the explicit sign extension instruction (mov32)
  bool HasExplicitSignExt;

  // Whether we enable the new encoding for memory instructions
  bool NewMemEncoding;

  // Whether we are using AbiV2
  bool IsAbiV2;

  std::unique_ptr<CallLowering> CallLoweringInfo;
  std::unique_ptr<InstructionSelector> InstSelector;
  std::unique_ptr<LegalizerInfo> Legalizer;
  std::unique_ptr<RegisterBankInfo> RegBankInfo;

public:
  // This constructor initializes the data members to match that
  // of the specified triple.
  TBFSubtarget(const Triple &TT, const std::string &CPU, const std::string &FS,
               const TargetMachine &TM);

  TBFSubtarget &initializeSubtargetDependencies(const Triple &TT, StringRef CPU,
                                                StringRef FS);

  // ParseSubtargetFeatures - Parses features string setting specified
  // subtarget options.  Definition of function is auto generated by tblgen.
  void ParseSubtargetFeatures(StringRef CPU, StringRef TuneCPU, StringRef FS);
  bool getHasJmpExt() const { return HasJmpExt; }
  bool getHasAlu32() const { return HasAlu32; }
  bool getHasDynamicFrames() const { return HasDynamicFrames; }
  bool getUseDwarfRIS() const { return UseDwarfRIS; }
  bool getDisableNeg() const { return DisableNeg; }
  bool getReverseSubImm() const { return ReverseSubImm; }
  bool getNoLddw() const { return NoLddw; }
  bool getCallXRegSrc() const { return CallxRegSrc; }
  bool getHasPqrClass() const { return HasPqrClass; }
  bool getHasStoreImm() const { return HasStoreImm; }
  bool getHasExplicitSignExt() const { return HasExplicitSignExt; }
  bool getNewMemEncoding() const { return NewMemEncoding; }
  bool getHasStaticSyscalls() const { return HasStaticSyscalls; }
  const TBFInstrInfo *getInstrInfo() const override { return &InstrInfo; }
  const TBFFrameLowering *getFrameLowering() const override {
    return &FrameLowering;
  }
  const TBFTargetLowering *getTargetLowering() const override {
    return &TLInfo;
  }
  const TBFSelectionDAGInfo *getSelectionDAGInfo() const override {
    return &TSInfo;
  }
  const TBFRegisterInfo *getRegisterInfo() const override {
    return &InstrInfo.getRegisterInfo();
  }
};
} // namespace llvm

#endif
